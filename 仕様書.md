# HTML/SVG自動プレビューツール 仕様書 v2.1

## 📌 プロジェクト概要
Claude CodeでHTML/SVG生成時に、自動でブラウザプレビュー表示するツール

---

## 🎯 背景・目的

### 現状の課題
- Claude回答内のHTMLコード → 手動でブラウザ表示
- 手順: リンククリック → VSCodeでコード表示 → 右クリック「ブラウザで開く」
- **繰り返し作業が非効率**

### 目的
- ✅ HTML/SVG生成 → 即ブラウザ表示
- ✅ デザイン確認の高速化
- ✅ プロトタイプ開発の効率化
- ✅ 会社PC（Node.js不可）でも動作

---

## 💡 ユースケース

### 想定シーン
1. **デザイン確認**: CSS調整の繰り返し
2. **動作テスト**: JavaScript動作確認
3. **レスポンシブ**: スマホ表示チェック
4. **プロトタイプ**: アイデア高速検証
5. **会社での利用**: インストール不要で即実行

### 利用フロー（クリップボード連動型）
```
Claude Code: HTMLコード出力
  ↓
ユーザー: コードブロックをコピー（Ctrl+C）
  ↓
ツール: クリップボード監視→HTMLコード検知
  ↓
ファイル保存: images/preview-20260213-153045.html
  ↓
✅ 自動でブラウザ起動
```

---

## 🔧 機能要件

### 確定した実装パターン

#### パターンC: クリップボード連動型（メイン・最優先）
**対象環境**: 会社PC・自宅PC両方

**機能**:
- クリップボード監視（1秒ごと）
- HTML/SVGコード判定
  - **HTML**: `</html>` タグを含む
  - **SVG**: `<svg` で始まる、または `<?xml` と `<svg` を含む
- 固定フォルダに保存
  - 会社PC: `C:\Users\guest04\Desktop\高橋研三\03_knowledge\images`
  - 自宅PC: `D:\50_knowledge\images`
  - 自動判定: 両方のパスを試して存在する方を使用
- ファイル名: タイムスタンプ形式 `preview-YYYYMMDD-HHMMSS.html` または `.svg`
- フォルダなし時: エラーで停止
- ブラウザ自動起動（Windowsの`start`コマンド）

**配布方法**:
- ZIP形式で配布
- EXE化（pkg使用）→ **Node.jsインストール不要**
- 会社PCでも実行可能

#### パターンA: ファイル監視型（サブ・自宅用）
**対象環境**: 自宅PC（Node.jsあり）

**機能**:
- プロジェクト全体を再帰的に監視
- 除外パターン: `node_modules/`, `bkup/`, `venv/`, `__pycache__/`, `.git/`
- `.html`, `.svg` ファイル作成/更新検知→ブラウザ自動起動

**配布方法**:
- Node.jsスクリプト（`node watch.js`で実行）

#### パターンB: リンククリック型（Phase 3・まだ先）
**対象環境**: VSCode

**機能**:
- Claude CodeのHTMLリンククリック→VSCodeエディタスキップ→直接ブラウザ表示
- VSCode拡張 or Claude Code Hook活用（技術調査後に決定）

#### Phase 2.5: MDファイルへのリンク挿入（まだ先）
**対象環境**: VSCode

**機能**:
- ホットキー（Alt+Ctrl+V など検討中）でMDファイルにリンク挿入
- フォーマット: `[プレビュー](images/preview-20260213-153045.html)`
- リンククリック→ブラウザ表示

---

## 🛠 技術スタック

### 実装方式
**Node.jsスクリプト → EXE化**

### 使用技術
- **言語**: JavaScript (Node.js)
- **クリップボード監視**: `clipboardy` パッケージ
- **ファイル監視** (パターンA): `chokidar` パッケージ
- **ブラウザ起動**: `child_process.exec()`
- **EXE化**: `pkg` パッケージ

### 動作環境
- OS: Windows 11
- Node.js: v18以上推奨（開発環境のみ）
- 実行環境: Node.js不要（EXE版）

---

## 📂 プロジェクト構成

```
65_HTML自動プレビュー/
├── 仕様書.md                    # 本ファイル
├── package.json                 # 依存関係管理
├── clipboard-watch.js           # クリップボード監視スクリプト（メイン）
├── watch.js                     # ファイル監視スクリプト（サブ）
├── config.json                  # 設定ファイル（オプション）
├── README.md                    # 使い方
├── build/
│   └── clipboard-watch.exe      # EXE化されたファイル（配布用）
└── dist/
    └── html-preview-tool.zip    # ZIP配布パッケージ
```

---

## 🚀 実装フェーズ

### Phase 1: クリップボード連動型（最優先）
- [x] 仕様確定
- [ ] `clipboard-watch.js` 実装
  - [ ] クリップボード監視
  - [ ] HTMLコード判定
  - [ ] 保存先自動判定（会社/自宅）
  - [ ] ファイル保存（タイムスタンプ形式）
  - [ ] ブラウザ起動
  - [ ] エラーハンドリング
- [ ] EXE化（pkg）
- [ ] ZIP配布パッケージ作成
- [ ] 動作確認（会社PC・自宅PC）

### Phase 2: ファイル監視型（サブ）
- [ ] `watch.js` 実装
  - [ ] プロジェクト全体監視
  - [ ] 除外パターン設定
  - [ ] ブラウザ自動起動
- [ ] 動作確認（自宅PC）

### Phase 3: リンククリック型（まだ先）
- [ ] 技術調査
  - [ ] VSCode拡張機能の可能性
  - [ ] Claude Code Hook活用
- [ ] 実装方針決定
- [ ] 実装・動作確認

### Phase 2.5: MDファイルへのリンク挿入（まだ先）
- [ ] ホットキー検討
- [ ] リンク挿入機能実装
- [ ] VSCode拡張 or AutoHotkey選定

### Phase 4: 拡張機能（オプション）
- [ ] ライブリロード機能（WebSocket or Browser Sync）
- [ ] 設定ファイル（`config.json`）による柔軟な設定
- [ ] 特定ブラウザ指定
- [ ] 複数タブ起動制御（デバウンス処理）
- [ ] 詳細ログ・デバッグモード
- [ ] 一時ファイル自動削除機能

---

## 📋 実装詳細（Phase 1: クリップボード連動型）

### clipboard-watch.js

```javascript
const clipboardy = require('clipboardy');
const fs = require('fs');
const path = require('path');
const { exec } = require('child_process');

// 保存先候補（自動判定）
const savePaths = [
  'C:\\Users\\guest04\\Desktop\\高橋研三\\03_knowledge\\images',
  'D:\\50_knowledge\\images'
];

let lastContent = '';

// 保存先フォルダ取得
function getSavePath() {
  for (const p of savePaths) {
    if (fs.existsSync(p)) {
      return p;
    }
  }
  throw new Error('❌ 保存先フォルダが見つかりません');
}

// ファイル名生成（タイムスタンプ形式）
function getFileName() {
  const now = new Date();
  const timestamp = now.toISOString()
    .replace(/[-:]/g, '')
    .replace('T', '-')
    .split('.')[0]; // 20260213-153045

  return `preview-${timestamp}.html`;
}

// HTMLコード判定
function isHTML(text) {
  return text.includes('<!DOCTYPE html>') ||
         text.includes('<html>') ||
         text.includes('<HTML>') ||
         (text.includes('<head>') && text.includes('<body>'));
}

// ファイル保存＆ブラウザ起動
function saveAndOpenHTML(htmlContent) {
  try {
    const saveDir = getSavePath();
    const fileName = getFileName();
    const fullPath = path.join(saveDir, fileName);

    fs.writeFileSync(fullPath, htmlContent, 'utf8');
    console.log(`✅ ファイル保存: ${fullPath}`);

    // Windowsでブラウザ起動
    exec(`start "" "${fullPath}"`, (error) => {
      if (error) {
        console.error('❌ ブラウザ起動失敗:', error.message);
      } else {
        console.log('✅ ブラウザ起動成功');
      }
    });
  } catch (error) {
    console.error('❌ エラー:', error.message);
  }
}

// クリップボード監視（1秒ごと）
setInterval(async () => {
  try {
    const content = await clipboardy.read();

    // 前回と同じ内容なら無視
    if (content === lastContent) return;
    lastContent = content;

    // HTMLコードか判定
    if (isHTML(content)) {
      console.log('🔍 HTMLコード検知');
      saveAndOpenHTML(content);
    }
  } catch (error) {
    console.error('❌ クリップボード読み込みエラー:', error.message);
  }
}, 1000);

console.log('🔍 クリップボード監視開始...');
console.log('   HTMLコードをコピーすると自動でブラウザ表示します');
console.log('   停止: Ctrl+C');
```

### package.json

```json
{
  "name": "html-auto-preview",
  "version": "2.0.0",
  "description": "Claude Code用HTML自動プレビューツール",
  "main": "clipboard-watch.js",
  "scripts": {
    "start": "node clipboard-watch.js",
    "watch": "node watch.js",
    "build": "pkg clipboard-watch.js -t node18-win-x64 -o build/clipboard-watch.exe"
  },
  "dependencies": {
    "clipboardy": "2.3.0",
    "chokidar": "^4.0.1"
  },
  "devDependencies": {
    "pkg": "^5.8.1"
  }
}
```

### EXE化コマンド

```bash
# 依存関係インストール
npm install

# EXE化
npm run build

# 生成されるファイル
# build/clipboard-watch.exe (約40MB)
```

---

## ⚠ 注意事項・制約

### 技術的制約
- Windows専用（macOS/Linuxは別コマンド必要）
- クリップボード監視の遅延（1秒）
- EXEファイルサイズ（約40MB）

### セキュリティ
- ローカルファイルのみ対象
- 外部通信なし
- クリップボード内容の読み取り（HTMLのみ保存）

### 動作要件
- 保存先フォルダが存在すること
  - 会社PC: `C:\Users\guest04\Desktop\高橋研三\03_knowledge\images`
  - 自宅PC: `D:\50_knowledge\images`
- フォルダがない場合はエラーで停止

---

## 📝 使い方（Phase 1完成後）

### EXE版（会社PC・自宅PC共通）

1. **セットアップ**
   ```
   html-preview-tool.zip を解凍
   ```

2. **起動**
   ```
   clipboard-watch.exe をダブルクリック
   ```

3. **使い方**
   ```
   1. clipboard-watch.exe 起動
   2. Claude CodeでHTML生成
   3. HTMLコードをコピー（Ctrl+C）
   4. 自動でブラウザ表示 ✅
   ```

4. **停止**
   ```
   Ctrl+C または ウィンドウを閉じる
   ```

### Node.js版（自宅PC・開発用）

1. **セットアップ**
   ```bash
   npm install
   ```

2. **起動**
   ```bash
   # クリップボード監視型
   npm start
   # または
   node clipboard-watch.js

   # ファイル監視型
   npm run watch
   # または
   node watch.js
   ```

3. **停止**
   ```
   Ctrl+C
   ```

---

## 📝 参考資料

### 類似ツール
- Live Server (VSCode拡張)
- Browser Sync
- http-server

### 差別化ポイント
- ✅ **インストール不要**（EXE版）
- ✅ **会社PCでも動作**（Node.js不要）
- ✅ **クリップボード連動**（コピーするだけ）
- ✅ **固定フォルダ保存**（ファイル管理しやすい）
- ✅ **Claude Code特化**（HTML生成に最適化）

---

## 🔄 更新履歴

- **v2.1** (2026-02-14)
  - SVG対応を追加（HTML/SVG両対応）
  - ファイルタイプ自動判定機能追加
  - HTTPサーバーのContent-Type自動判定追加
  - クリーニング機能でSVG対応

- **v2.0** (2026-02-13)
  - クリップボード連動型をメイン機能として確定
  - EXE化による配布方法を追加
  - 保存先フォルダを固定（会社/自宅自動判定）
  - ファイル名をタイムスタンプ形式に変更
  - Phase 2.5（MDファイルへのリンク挿入）を追加

- **v1.0** (2026-02-13)
  - 初版作成
  - 基本コンセプトの策定
